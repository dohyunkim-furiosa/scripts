{
	"version": "2.0.0",
	"tasks": [
		{
			"label": "script",
			"type": "shell",
			"command": "bash",
			"args": ["-c", "${input:scripts}"]
		},
		{
			"label": "dependency update",
			"type": "shell",
			"command": "git submodule deinit --all -f && git submodule update --recursive --init --force && cargo use_renegade -r",
		},
		{
			"label": "credential update",
			"type": "shell",
			"command": "xdg-open ${input:credential-links}",
		},
		{
			"label": "ci trigger",
			"type": "shell",
			"command": "python3 tekton/run_pipeline.py ${input:commit-hash} ${input:ci-action}",
		},
		// origin이랑 furiosa 결정하는 옵션 추가하던지 해야해서 일단 주석처리함.
		// {
		// 	"label": "reset and force push to",
		// 	"type":"shell",
		// 	"command": "BRANCH=${input:temp-branches} && git branch -f $BRANCH HEAD && git push -f origin $BRANCH"
		// },
		{
			"label": "RNGD setting",
			"type": "shell",
			"command": "cd crates/device-runtime/pert && cargo build --bin pert --target aarch64-unknown-none-softfloat -r && aarch64-none-elf-objcopy -O binary ../target/aarch64-unknown-none-softfloat/release/pert pe_boot.bin && sudo -S furiosa_pert_deploy -d ${input:npu-id} -f pe_boot.bin && sudo sh -c 'echo performance > /sys/class/rngd_mgmt/rngd\\!${input:npu-id}mgmt/npu_governor'",
		},
	],

    "inputs": [
        {
            "id": "npu-id",
            "type": "pickString",
            "default": "npu0",
            "options": [
                "npu0",
                "npu1",
            ],
            "description": "",
        },
        {
            "id": "commit-hash",
            "type": "promptString",
            "default": "HEAD",
            "description": "",
        },
        {
            "id": "temp-branches",
            "type": "pickString",
            "default": "test1",
			"options":[
				"wip",
				"test0",
				"test1",
				"rngd-ci/test-dohyun",
				"rngd-ci/test-dohyun-2"
			],
            "description": "",
        },
        {
            "id": "ci-action",
            "type": "pickString",
            "default": "run",
            "options": [
                "build",
                "cancel-pipelines",
                "run",
                "manual-daily-test(todo)",
            ],
            "description": "",
        },
        {
            "id": "credential-links",
            "type": "pickString",
            "default": "run",
            "options": [
                "https://aws-cli.furiosa.dev", // dvc
                "https://k8s-all-login.furiosa.in", // AWS K8S: CI의 aws접근 권한, Dosan SW Team: pod 생성 권한
            ],
            "description": "",
        },
        {
            "id": "scripts",
            "type": "pickString",
            "default": "`git rev-parse --path-format=absolute --git-common-dir`/hooks/pre-push &> check.log",
            "options": [
				"`git rev-parse --path-format=absolute --git-common-dir`/hooks/pre-push &> check.log",
				"wolfrevo/test.sh &> test.log",
				"wolfrevo/test2.sh &> test2.log",
				"wolfrevo/test.sh",
				"wolfrevo/test2.sh",
				"wolfrevo/reuse-edf.sh",
            ],
            "description": "",
        },
		// {
		// 	"id":"redirect",
		// 	"type": "pickString",
		// 	"default": "&> test.log",
		// 	"options":[
		// 		{
		// 			"label": "stdout",
		// 			"value": ""
		// 		},{
		// 			"label": "test.log",
		// 			"value": "&> test.log"
		// 		}
		// 	],
		// 	"description": ""
		// },
    ]
}